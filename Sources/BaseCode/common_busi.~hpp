#ifndef  _buis_common_util_
#define  _buis_common_util_

#include <vcl.h>
#include "common.hpp"

bool chkFormatContainerNo(AnsiString ss){
        if (ss.Length()!=11){
                ShowMessage("柜号格式长度应为11");
                return false;
        }
        char cinfo[12];
        memset(cinfo, 0x00, sizeof(cinfo));
        snprintf(cinfo, 11, ss.c_str());


        for (int i=0;i<4; ++i){
                if (!(cinfo[i]>='a' && cinfo[i]<='z') && !(cinfo[i]>='A' && cinfo[i]<='Z')){
                        ShowMessage("柜号格式非法，前1-4位应为英文字母");
                        return false;
                }
        }
        for (int i=4;i<11; ++i){
                if (!(cinfo[i]>='0' && cinfo[i]<='9')){
                        ShowMessage("柜号格式非法，5-12位应为数字");
                        return false;
                }
        }

        return true;
}

//组装集装箱信息:“柜数|箱号 柜型 封条号#箱号 柜型 封条号#@”
CString GetContainerInfo(TListView *lv){
        CString szContInfo;
        szContInfo += (IntToStr(lv->Items->Count)).c_str();
        szContInfo += '|';
        for (int i=0; i<lv->Items->Count; ++i) {
                szContInfo += lv->Items->Item[i]->Caption.c_str();
                szContInfo += ' ';
                szContInfo += lv->Items->Item[i]->SubItems->Strings[0].c_str();
                szContInfo += ' ';
                szContInfo += lv->Items->Item[i]->SubItems->Strings[1].c_str();
                szContInfo += '#';
        }
        szContInfo += '@';
        return szContInfo;
}

void flushContainer(TListView *lstViewContainer, TEdit *edtContainerNo, TEdit *cbbContainerType, TEdit *edtSealId, AnsiString c){
        lstViewContainer->Items->Clear();

		char cnt[10];memset(cnt,sizeof(cnt),0x00);
		char body[2048];memset(body,sizeof(body),0x00);
		sscanf(c.c_str(),"%[^|]|",cnt);
		sscanf(c.c_str(),"%*[^|]|%[^@]",body);

		char strTmp1[2048];
		memset(strTmp1,sizeof(strTmp1),0x00);
		strcpy(strTmp1,body);
                int num = StrToInt(cnt);
		for (int i =0; i<num; ++i){
			char str1[100],str2[100],str3[100],str4[100],strTmp[2048],strSealId[100];
			memset(str1,sizeof(str1),0x00);
			memset(str2,sizeof(str2),0x00);
			memset(str3,sizeof(str3),0x00);
			memset(str4,sizeof(str4),0x00);
			memset(strSealId,sizeof(strSealId),0x00);

			memset(strTmp,sizeof(strTmp),0x00);
			strcpy(strTmp,strTmp1);
			sscanf(strTmp,"%[^#]#",str1);
			sscanf(str1,"%s %s %s",str3,str4,strSealId);
			sscanf(strTmp,"%*[^#]#%[^@]",strTmp1);
//			printf("head:[%s] tail:[%s]\n", str1, strTmp1);
//			printf("bno:[%s] type:[%s]\n\n", str3, str4);

                        TListItem *pItem =lstViewContainer->Items->Add();
                        assert(pItem!=NULL);
                        pItem->Caption=AnsiString(str3);
                        pItem->SubItems->Add(AnsiString(str4));
                        pItem->SubItems->Add(AnsiString(strSealId));

		}


        if (lstViewContainer->Items->Count>0){
                edtContainerNo->Text = lstViewContainer->Items->Item[0]->Caption;
                cbbContainerType->ItemIndex=cbbContainerType->Items->IndexOf(lstViewContainer->Items->Item[0]->SubItems->Strings[0]);
                edtSealId->Text = lstViewContainer->Items->Item[0]->SubItems->Strings[1];
        }

}
//把edit转成money
double edt2money(TEdit *edt, int decimal_place=0){
        double rt = 0;
        AnsiString s = edt->Text;
        try{
                if (isMoney(s, decimal_place)){
                        TryStrToFloat(s, rt);
                }
        }catch(...){
        }
        return rt;
}
#endif